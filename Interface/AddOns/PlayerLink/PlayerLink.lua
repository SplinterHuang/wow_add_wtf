 local PLAYER_LINK_COPY_MESSAGE,PLAYER_LINK_MENU if LOCALE_zhCN then PLAYER_LINK_MENU = "菜单增强" PLAYER_LINK_COPY_MESSAGE = "|cff00adef<菜单增强>|r [|cff00ff00%s|r]的名字已经被复制，你可以通过在输入框键入|cffffff00<ALT+上>|r来获取。"; elseif LOCALE_zhTW then PLAYER_LINK_MENU = "菜單增強" PLAYER_LINK_COPY_MESSAGE = "|cff00adef<菜單增強>|r [|cff00ff00%s|r]的名字已經被複製，你可以通過在輸入框鍵入|cffffff00<ALT+上>|r來獲取。"; else PLAYER_LINK_MENU = "PLAYER_LINK_MENU" PLAYER_LINK_COPY_MESSAGE = "|cff00adef<PlayerLink>|r The name of [%s] has been logged, you can get it by pressing |cffffff00<ALT+Up>|r."; end local EnhancedMenu_Items = { ["ENHANCED_MENU"] = PLAYER_LINK_MENU, ["COPY_NAME"] = COPY_NAME, ["ADD_FRIEND"] = ADD_FRIEND, ["GUILD_INVITE"] = CHAT_INVITE_SEND..CHAT_MSG_GUILD, ["SEND_WHO"] = WHO..PLAYER_MESSAGES, } local EnhancedMenu_Which = {} EnhancedMenu_Which["COPY_NAME"] = { ["SELF"] = true, ["TARGET"] = true, ["PLAYER"] = true, } EnhancedMenu_Which["ADD_FRIEND"] = { ["FRIEND"] = true, ["PLAYER"] = true, } EnhancedMenu_Which["GUILD_INVITE"] = { ["FRIEND"] = true, ["PLAYER"] = true, } EnhancedMenu_Which["SEND_WHO"] = { ["FRIEND"] = true, } local buttons = {} local EnhancedMenu_ItemOrder = {"COPY_NAME", "ADD_FRIEND", "GUILD_INVITE", "SEND_WHO"} local function PrepareButtons(which) wipe(buttons) local i = 0 for _, itemName in pairs(EnhancedMenu_ItemOrder) do if EnhancedMenu_Which[itemName][which] then i = i + 1 tinsert(buttons, itemName) end end if i ~= 0 then return true end end local EnhancedMenu_Func = {} EnhancedMenu_Func["COPY_NAME"] = function(name, server) if name and server then if (ChatFrameEditBox:IsVisible()) then ChatFrameEditBox:Insert(name); else ChatFrameEditBox:AddHistoryLine(name); BigFoot_Print(string.format(PLAYER_LINK_COPY_MESSAGE, name)); end end end EnhancedMenu_Func["ADD_FRIEND"] = function(name, server) if name and server then local fullName if GetRealmName() == server then fullName = name else fullName = name.."-"..server end if not C_FriendList.GetFriendInfo(fullName) then C_FriendList.AddFriend(fullName); end end end EnhancedMenu_Func["GUILD_INVITE"] = function(name, server) if CanGuildInvite() and name and server then local fullName if GetRealmName() == server then fullName = name else fullName = name.."-"..server end GuildInvite(fullName); end end EnhancedMenu_Func["SEND_WHO"] = function(name, server) if name and server then C_FriendList.SetWhoToUi(false) C_FriendList.SendWho("n-"..name) end end local EnhancedMenu_Menu = { "PLAYER","FRIEND","PARTY","RAID_PLAYER","SELF","BN_FRIEND", "TARGET","FRIEND_OFFLINE","COMMUNITIES_GUILD_MEMBER" } for _, menuName in pairs(EnhancedMenu_Menu) do Menu.ModifyMenu("MENU_UNIT_"..menuName, function(ownerRegion, rootDescription, contextData) if PrepareButtons(contextData.which) then rootDescription:CreateDivider() rootDescription:CreateTitle(EnhancedMenu_Items["ENHANCED_MENU"]) local name, server = contextData.name, contextData.server or GetRealmName() for _, info in pairs(buttons) do rootDescription:CreateButton(EnhancedMenu_Items[info], function() EnhancedMenu_Func[info](name, server) end) end end end) end
